<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static',  filename='style.css')}}" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script>
        $(function(){
            $('#nfl_navbar').load("{{ url_for('nfl_navbar') }}")
        })
        $(function(){
            $('#header').load("{{ url_for('header') }}")
        })
    </script>
</head>
<body>
    <div id="header"></div>
    <div id="nfl_navbar"></div>
    
    <h1>{{ fullname }} Opportunities - DEBUG</h1>
    <h2>{{ selected_year }} Season</h2>
    
    {% if loading %}
        <div style="background: #fff3cd; padding: 20px; margin: 20px 0; border-radius: 8px;">
            <p>üìä Opportunity data is being calculated...</p>
            <p>Please refresh the page in a moment.</p>
        </div>
    {% else %}
        <!-- Debug Information -->
        <div style="background: #e7f3ff; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #0066cc;">
            <h3>üîç Debug Information</h3>
            
            <div style="margin: 15px 0;">
                <strong>Team Info:</strong>
                {% if team_info %}
                    <pre style="background: white; padding: 10px; overflow-x: auto;">{{ team_info }}</pre>
                {% else %}
                    <p style="color: red;">‚ùå No team info available</p>
                {% endif %}
            </div>
            
            <div style="margin: 15px 0;">
                <strong>Available Weeks:</strong>
                {% if available_weeks %}
                    <p>{{ available_weeks }}</p>
                {% else %}
                    <p style="color: red;">‚ùå No weeks available</p>
                {% endif %}
            </div>
            
            <div style="margin: 15px 0;">
                <strong>Stat Type Data Keys:</strong>
                {% if stat_type_data %}
                    <p>{{ stat_type_data.keys()|list }}</p>
                    <p>Total stats: {{ stat_type_data|length }}</p>
                    
                    {% for stat_key, players in stat_type_data.items() %}
                        <div style="margin: 10px 0; padding: 10px; background: white; border-left: 3px solid #28a745;">
                            <strong>{{ stat_key }}:</strong> {{ players|length }} players
                            {% if players|length > 0 %}
                                <details style="margin-top: 10px;">
                                    <summary>Show first player data</summary>
                                    <pre style="font-size: 11px; overflow-x: auto;">{{ players[0] }}</pre>
                                </details>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: red;">‚ùå No stat_type_data available</p>
                {% endif %}
            </div>
            
            <div style="margin: 15px 0;">
                <strong>Plot Data:</strong>
                {% if plot_data %}
                    <p>Plot data keys: {{ plot_data.keys()|list }}</p>
                {% else %}
                    <p style="color: orange;">‚ö†Ô∏è No plot data available</p>
                {% endif %}
            </div>
            
            <div style="margin: 15px 0;">
                <strong>Insights:</strong>
                {% if insights %}
                    <p>Insight keys: {{ insights.keys()|list }}</p>
                {% else %}
                    <p style="color: orange;">‚ö†Ô∏è No insights available</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Simple Data Display Test -->
        {% if stat_type_data %}
            <div style="margin: 30px 0;">
                <h2>üìä Simple Data Display Test</h2>
                
                {% for stat_key, players in stat_type_data.items() %}
                    <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3>{{ stat_key|replace('_', ' ')|title }} ({{ players|length }} players)</h3>
                        
                        {% if players|length > 0 %}
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #343a40; color: white;">
                                        <th style="padding: 10px; text-align: left;">Player</th>
                                        <th style="padding: 10px; text-align: center;">Position</th>
                                        <th style="padding: 10px; text-align: center;">Weeks</th>
                                        <th style="padding: 10px; text-align: center;">Avg</th>
                                        <th style="padding: 10px; text-align: center;">Max</th>
                                        <th style="padding: 10px; text-align: center;">Trend %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for player in players[:10] %}
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 8px;">{{ player.player_name }}</td>
                                            <td style="padding: 8px; text-align: center;">{{ player.position }}</td>
                                            <td style="padding: 8px; text-align: center;">{{ player.weeks_played }}</td>
                                            <td style="padding: 8px; text-align: center;">{{ "%.1f"|format(player[stat_key + '_avg']) }}</td>
                                            <td style="padding: 8px; text-align: center;">{{ player[stat_key + '_max'] }}</td>
                                            <td style="padding: 8px; text-align: center; {% if player[stat_key + '_trend'] > 10 %}color: green;{% elif player[stat_key + '_trend'] < -10 %}color: red;{% endif %}">
                                                {{ "%.0f"|format(player[stat_key + '_trend']) }}%
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            {% if players|length > 10 %}
                                <p style="margin-top: 10px; color: #6c757d; font-style: italic;">Showing 10 of {{ players|length }} players</p>
                            {% endif %}
                        {% else %}
                            <p style="color: #6c757d; font-style: italic;">No players with {{ stat_key }} data</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="background: #f8d7da; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #dc3545;">
                <h3>‚ùå No Data Available</h3>
                <p>stat_type_data is empty or None</p>
                <p>This usually means:</p>
                <ul>
                    <li>No opportunity data file exists for this year</li>
                    <li>The data file is empty</li>
                    <li>The team has no recorded opportunities</li>
                    <li>There was an error processing the data</li>
                </ul>
                <p><strong>Check the server logs for more details.</strong></p>
            </div>
        {% endif %}
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="{{ url_for('update_opportunities') }}" style="display: inline-block; padding: 12px 24px; background-color: #28a745; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                üîÑ Update Opportunity Data
            </a>
            <a href="{{ url_for('opportunities_home') }}" style="display: inline-block; padding: 12px 24px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; margin-left: 10px;">
                ‚Üê Back to Overview
            </a>
        </div>
    {% endif %}
</body>
</html>